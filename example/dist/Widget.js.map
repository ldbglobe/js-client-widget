{"version":3,"file":"Widget.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///../src/components/EventDispatcher.js","webpack:///../src/components/Messenger.js","webpack:///../src/components/ClientComponent.js","webpack:///../src/components/WidgetComponent.js","webpack:///./src/Widget.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default class EventDispatcher {\r\n\tconstructor(eventSource) {\r\n\t\tthis.eventSource = eventSource;\r\n\t\tthis.events = new Set();\r\n\t}\r\n\r\n\t// registration methods\r\n\tregisterEvent(eventName, callback) {\r\n\t\tif(typeof callback === \"function\")\r\n\t\t{\r\n\t\t\tif(!this.events[eventName])\r\n\t\t\t\tthis.events[eventName] = new Set();\r\n\r\n\t\t\tthis.events[eventName].add(callback)\r\n\t\t}\r\n\t}\r\n\tunregisterEvent(eventName, callback) {\r\n\t\tif(this.events[eventName])\r\n\t\t\tthis.events[eventName].delete(callback)\r\n\t}\r\n\r\n\t// trigger event\r\n\tfireEvent(eventName, data) {\r\n\t\tif(this.events[eventName])\r\n\t\t{\r\n\t\t\tthis.events[eventName].forEach(function(callback, index) {\r\n\t\t\t\tcallback(data,{\r\n\t\t\t\t\teventSource:this.eventSource,\r\n\t\t\t\t\teventName:eventName,\r\n\t\t\t\t\tdata:data\r\n\t\t\t\t});\r\n\t\t\t}.bind(this))\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\n\r\nexport default class Messenger {\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.setRecipient(param.recipient);\r\n\r\n\t\tthis.id = param.id || (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16)))();\r\n\t\tthis.events = new EventDispatcher(this);\r\n\t\twindow.addEventListener('message', this.__handleMessage.bind(this))\r\n\t}\r\n\r\n\tclearRecipient() {\r\n\t\tthis.recipients = new Set();\r\n\t}\r\n\tsetRecipient(browserWindow) {\r\n\t\tif(browserWindow && browserWindow.length > 0)\r\n\t\t{\r\n\t\t\tthis.recipients = new Set(browserWindow);\r\n\t\t}\r\n\t\telse if(browserWindow)\r\n\t\t{\r\n\t\t\tthis.recipients = new Set([browserWindow]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.clearRecipient();\r\n\t\t}\r\n\t}\r\n\taddRecipient(browserWindow) {\r\n\t\tif(browserWindow)\r\n\t\t{\r\n\t\t\tthis.recipients.add(browserWindow);\r\n\t\t}\r\n\t}\r\n\tdeleteRecipient(browserWindow) {\r\n\t\tif(browserWindow)\r\n\t\t{\r\n\t\t\tthis.recipients.delete(browserWindow);\r\n\t\t}\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\ton(eventName,callback) { this.events.registerEvent(eventName,callback) }\r\n\toff(eventName,callback) { this.events.unregisterEvent(eventName,callback) }\r\n\r\n\t__handleMessage(e) {\r\n\t\tlet data = typeof e.data === \"string\" ? JSON.parse(e.data) : (e.data || {});\r\n\t\tif(data.format === 'messenger' && data.id === this.id)\r\n\t\t\tthis.events.fireEvent('message',data.message);\r\n\t}\r\n\r\n\tsend(message) {\r\n\t\tif(this.recipients.size > 0)\r\n\t\t{\r\n\t\t\tthis.recipients.forEach(function(message, recipient) {\r\n\t\t\t\tif(typeof recipient.postMessage === \"function\")\r\n\t\t\t\t{\r\n\t\t\t\t\trecipient.postMessage(JSON.stringify({\r\n\t\t\t\t\t\tformat:'messenger',\r\n\t\t\t\t\t\tversion:1,\r\n\t\t\t\t\t\tid:this.id,\r\n\t\t\t\t\t\tmessage:message,\r\n\t\t\t\t\t}),\"*\");\r\n\t\t\t\t}\r\n\t\t\t}.bind(this,message));\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\nimport Messenger from \"./Messenger.js\";\r\n\r\nexport default class ClientComponent {\r\n\tstatic ___ = {\r\n\t\topened:null,\r\n\t\tinstances:new Set(),\r\n\t};\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.___ = {\r\n\t\t\tid: (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16)))(),\r\n\t\t\twidgetUrl: param.widgetUrl || null,\r\n\t\t\twidgetWindow: null,\r\n\t\t\tcloseDetectionInterval: null,\r\n\r\n\t\t};\r\n\t\tthis.___.events = new EventDispatcher(this);\r\n\t\tthis.___.messenger = new Messenger({id:this.___.id});\r\n\t\tthis.___.messenger.on('message',this.___handleMessage.bind(this));\r\n\r\n\t\tif(!this.___.widgetUrl)\r\n\t\t{\r\n\t\t\tthrow `widgetUrl parameter is mandatory`\r\n\t\t}\r\n\t\telse if(this.___.widgetUrl.match(/#/))\r\n\t\t{\r\n\t\t\tthrow `widgetUrl parameter can not contain any hash (${this.___.widgetUrl})`\r\n\t\t}\r\n\r\n\t\tClientComponent.___.instances.add(this);\r\n\t}\r\n\r\n\tstatic invokeAll(methodOrCallback,args) {\r\n\t\tif(typeof methodOrCallback === \"function\")\r\n\t\t{\r\n\t\t\tClientComponent.___.instances.forEach(function(client) { methodOrCallback(client) });\r\n\t\t}\r\n\t\telse if(typeof methodOrCallback === \"string\")\r\n\t\t{\r\n\t\t\tClientComponent.___.instances.forEach(function(client) {\r\n\t\t\t\treturn typeof client?.[methodOrCallback] === \"function\" ? client?.[methodOrCallback](...args) : null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t___getId() { return this.___.id; }\r\n\tgetId() { return this.___getId(); }\r\n\r\n\t/* --------------------------------------------------\r\n\t * Native available events\r\n\t * --------------------------------------------------\r\n\t * widget.open\r\n\t * widget.ready\r\n\t * widget.close\r\n\t*/\r\n\t___on(eventName,callback) { this.___.events.registerEvent(eventName,callback) }\r\n\ton(eventName,callback) { this.___on(eventName,callback); }\r\n\r\n\t___off(eventName,callback) { this.___.events.unregisterEvent(eventName,callback) }\r\n\toff(eventName,callback) { this.___off(eventName,callback); }\r\n\r\n\t// all the events are handled by the messenger services\r\n\t___fire(eventName,data,dest=null) {\r\n\t\t// send event to the widget\r\n\t\tif(dest === null || dest === \"broadcast\")\r\n\t\t\tthis.___.messenger.send({eventName, data});\r\n\t\t// fire the event locally\r\n\t\tif(dest === null || dest === \"local\")\r\n\t\t\tthis.___.events.fireEvent(eventName, data);\r\n\t}\r\n\tfire(eventName,data,dest=null) { this.___fire(eventName,data,dest); }\r\n\r\n\t___open() {\r\n\t\t// close current instance (if previously opened)\r\n\t\tthis.close();\r\n\r\n\t\t// close any other instances  previously opened\r\n\t\tif(ClientComponent.___.opened && ClientComponent.___.opened.id !== this.___.id)\r\n\t\t\tClientComponent.___.opened.___close();\r\n\t\tClientComponent.___.opened = this;\r\n\r\n\t\tthis.___.widgetWindow = window.open(`${this.___.widgetUrl}#id=${this.___.id}`, this.___.id, `resizable,scrollbars,width=640,height=480,top=200,left=200, dependent, modal`);\r\n\t\tthis.___.messenger.setRecipient(this.___.widgetWindow);\r\n\t\tthis.___fire('widget.open',null,\"local\");\r\n\t\tthis.___startDetectionLoop();\r\n\t}\r\n\topen() { this.___open(); }\r\n\r\n\t___close() {\r\n\t\tthis.___.messenger.clearRecipient();\r\n\t\tthis.___stopDetectionLoop();\r\n\t\tif(this.___.widgetWindow && !this.___.widgetWindow.closed)\r\n\t\t{\r\n\t\t\tthis.___.widgetWindow.close();\r\n\t\t\tthis.___.widgetWindow = null;\r\n\t\t\tthis.___fire('widget.close',null,\"local\");\r\n\t\t}\r\n\t}\r\n\tclose() { this.___close(); }\r\n\r\n\t// **********************************************************\r\n\t// private methods\r\n\t// **********************************************************\r\n\r\n\t// generic message handling and event dispatch\r\n\t___handleMessage(message) {\r\n\t\tif(message.eventName)\r\n\t\t{\r\n\t\t\t// received event => only local dispatch\r\n\t\t\tthis.___fire(message.eventName, message.data, \"local\");\r\n\t\t}\r\n\t}\r\n\t// passive detection of widget popup close event\r\n\t// we do not need messenging for this\r\n\t___stopDetectionLoop() {\r\n\t\tclearInterval(this.___.closeDetectionInterval);\r\n\t\tthis.___.closeDetectionInterval = null;\r\n\t}\r\n\t___startDetectionLoop() {\r\n\t\tif(this.___.widgetWindow.closed)\r\n\t\t{\r\n\t\t\tthis.___stopDetectionLoop();\r\n\t\t\t// widget is closed don't bother to send any message\r\n\t\t\t// just use internal dispatcher\r\n\t\t\tthis.___fire('widget.close',null,\"local\");\r\n\t\t}\r\n\t\telse if(!this.___.closeDetectionInterval)\r\n\t\t{\r\n\t\t\tthis.___.closeDetectionInterval = setInterval(this.___startDetectionLoop.bind(this),10);\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\nimport Messenger from \"./Messenger.js\";\r\n\r\nexport default  class WidgetComponent {\r\n\tstatic ___ = { };\r\n\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.___ = {\r\n\t\t\tid: param.id || this.___extractIdFromBRowserHash(), // as default behavior, JS client set the ID in the location hash\r\n\t\t\tparentWindow: param.parentWindow || window.opener,\r\n\t\t};\r\n\r\n\t\tthis.___.events = new EventDispatcher(this);\r\n\t\tthis.___.messenger = new Messenger({\r\n\t\t\tid:this.___.id,\r\n\t\t\trecipient: this.___.parentWindow\r\n\t\t});\r\n\t\tthis.___.messenger.on('message',this.___handleMessage.bind(this));\r\n\r\n\t\t// send a ready message to the opener\r\n\t\tsetTimeout(function(){ this.___fire('widget.ready',null,\"broadcast\"); }.bind(this),0);\r\n\t}\r\n\r\n\t___getId() { return this.___.id; }\r\n\tgetId() { return this.___getId(); }\r\n\r\n\t/* --------------------------------------------------\r\n\t * Native available events\r\n\t * --------------------------------------------------\r\n\t* [no native events]\r\n\t*/\r\n\r\n\t___on(eventName,callback) { this.___.events.registerEvent(eventName,callback); }\r\n\ton(eventName,callback) { this.___on(eventName,callback); }\r\n\r\n\t___off(eventName,callback) { this.___.events.unregisterEvent(eventName,callback); }\r\n\toff(eventName,callback) { this.___off(eventName,callback); }\r\n\r\n\t// all the events are handled by the messenger services\r\n\t___fire(eventName,data,dest=null) {\r\n\t\t// send event to the widget\r\n\t\tif(dest === null || dest === \"broadcast\")\r\n\t\t\tthis.___.messenger.send({eventName, data});\r\n\t\t// fire the event locally\r\n\t\tif(dest === null || dest === \"local\")\r\n\t\t\tthis.___.events.fireEvent(eventName, data);\r\n\t}\r\n\tfire(eventName,data,dest=null) { this.___fire(eventName,data,dest); }\r\n\r\n\t___extractIdFromBRowserHash() {\r\n\t\tvar reg = document.location.hash.match(/#id=([a-z0-9-]+)/)\r\n\t\tif(reg)\r\n\t\t\treturn reg[1];\r\n\t\telse\r\n\t\t\tthrow `Unable to retrieve the widget ID from location.hash`;\r\n\t\treturn null;\r\n\t}\r\n\r\n\t___handleMessage(message) {\r\n\t\tif(message.eventName)\r\n\t\t{\r\n\t\t\t// received event => only local dispatch\r\n\t\t\tthis.___fire(message.eventName,message.data,\"local\");\r\n\t\t}\r\n\t}\r\n}","import { WidgetComponent } from \"../../src/index.js\"\r\n\r\nexport default class Widget extends WidgetComponent {\r\n\r\n\t/* --------------------------------------------------\r\n\t * Inherited methods\r\n\t * --------------------------------------------------\r\n\t * getId()\r\n\t * on((string)eventName,(function)callback)\r\n\t * off((string)eventName,(function)callback)\r\n\t * fire((string)eventName,(mixed)data,([null,client,widget])destination)\r\n\t * --------------------------------------------------\r\n\t * Native available events name\r\n\t * --------------------------------------------------\r\n\t * [no native events]\r\n\t * --------------------------------------------------\r\n\t * Additionnal events from the extended Client class\r\n\t * --------------------------------------------------\r\n\t * display-message\r\n\t*/\r\n\r\n\tconstructor(param) {\r\n\t\tsuper(param);\r\n\t\tthis.messageBoard = typeof param.messageBoard === \"string\" ? document.querySelector(param.messageBoard) : param.messageBoard || null;\r\n\t\tthis.on('display-message',this.handleDisplayMessage.bind(this));\r\n\r\n\t\tthis.on('TEST-EVENT',() => console.log('TEST-EVENT received in the widget'));\r\n\t}\r\n\tselect(value) {\r\n\t\tthis.fire('select',value);\r\n\t}\r\n\thandleDisplayMessage(message) {\r\n\t\tif(this.messageBoard)\r\n\t\t\tthis.messageBoard.innerHTML = message;\r\n\t}\r\n}\r\nwindow.Widget = Widget;"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","EventDispatcher","eventSource","this","events","Set","eventName","callback","add","data","forEach","index","bind","Messenger","param","setRecipient","recipient","id","replace","a","Math","random","toString","window","addEventListener","__handleMessage","recipients","browserWindow","length","clearRecipient","registerEvent","unregisterEvent","e","JSON","parse","format","fireEvent","message","size","postMessage","stringify","version","ClientComponent","___","widgetUrl","widgetWindow","closeDetectionInterval","messenger","on","___handleMessage","match","instances","___getId","___on","___off","dest","send","___fire","close","opened","___close","open","___startDetectionLoop","___open","___stopDetectionLoop","closed","clearInterval","setInterval","methodOrCallback","args","client","WidgetComponent","___extractIdFromBRowserHash","parentWindow","opener","setTimeout","reg","document","location","hash","Widget","messageBoard","querySelector","handleDisplayMessage","console","log","fire","innerHTML"],"sourceRoot":""}