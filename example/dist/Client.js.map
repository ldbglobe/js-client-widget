{"version":3,"file":"Client.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///../src/components/EventDispatcher.js","webpack:///../src/components/Messenger.js","webpack:///../src/components/ClientComponent.js","webpack:///../src/components/WidgetComponent.js","webpack:///./src/Client.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default class EventDispatcher {\r\n\tconstructor(eventSource) {\r\n\t\tthis.eventSource = eventSource;\r\n\t\tthis.events = new Set();\r\n\t}\r\n\r\n\t// registration methods\r\n\tregisterEvent(eventName, callback) {\r\n\t\tif(typeof callback === \"function\")\r\n\t\t{\r\n\t\t\tif(!this.events[eventName])\r\n\t\t\t\tthis.events[eventName] = new Set();\r\n\r\n\t\t\tthis.events[eventName].add(callback)\r\n\t\t}\r\n\t}\r\n\tunregisterEvent(eventName, callback) {\r\n\t\tif(this.events[eventName])\r\n\t\t\tthis.events[eventName].delete(callback)\r\n\t}\r\n\r\n\t// trigger event\r\n\tfireEvent(eventName, data) {\r\n\t\tif(this.events[eventName])\r\n\t\t{\r\n\t\t\tthis.events[eventName].forEach(function(callback, index) {\r\n\t\t\t\tcallback(data,{\r\n\t\t\t\t\teventSource:this.eventSource,\r\n\t\t\t\t\teventName:eventName,\r\n\t\t\t\t\tdata:data\r\n\t\t\t\t});\r\n\t\t\t}.bind(this))\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\n\r\nexport default class Messenger {\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.id = param.id || (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16)))();\r\n\r\n\t\tthis.recipients = [];\r\n\t\tthis.setRecipient(param.recipient);\r\n\r\n\t\tthis.events = new EventDispatcher(this);\r\n\t\twindow.addEventListener('message', this.__handleMessage.bind(this))\r\n\t}\r\n\r\n\tclearRecipient() {\r\n\t\tthis.recipients = [];\r\n\t}\r\n\tsetRecipient(browserWindow) {\r\n\t\tthis.clearRecipient();\r\n\t\tthis.addRecipient(browserWindow);\r\n\t}\r\n\taddRecipient(browserWindow) {\r\n\t\tif(browserWindow)\r\n\t\t{\r\n\t\t\tif(this.recipients.indexOf(browserWindow)<0)\r\n\t\t\t\tthis.recipients.push(browserWindow);\r\n\t\t}\r\n\t}\r\n\tdeleteRecipient(browserWindow) {\r\n\t\tif(browserWindow && this.recipients.indexOf(browserWindow)>=0)\r\n\t\t{\r\n\t\t\tfor(let i=0; i<this.recipients.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(this.recipients[i] === browserWindow)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.recipients[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\ton(eventName,callback) { this.events.registerEvent(eventName,callback) }\r\n\toff(eventName,callback) { this.events.unregisterEvent(eventName,callback) }\r\n\r\n\t__handleMessage(e) {\r\n\t\tlet data = typeof e.data === \"string\" ? JSON.parse(e.data) : (e.data || {});\r\n\t\tif(data.format === 'messenger' && data.id === this.id)\r\n\t\t\tthis.events.fireEvent('message',data.message);\r\n\t}\r\n\r\n\tsend(message) {\r\n\t\tif(this.recipients.length > 0)\r\n\t\t{\r\n\t\t\tthis.recipients.forEach(function(message, recipient) {\r\n\t\t\t\tif(typeof recipient.postMessage === \"function\")\r\n\t\t\t\t{\r\n\t\t\t\t\trecipient.postMessage(JSON.stringify({\r\n\t\t\t\t\t\tformat:'messenger',\r\n\t\t\t\t\t\tversion:1,\r\n\t\t\t\t\t\tid:this.id,\r\n\t\t\t\t\t\tmessage:message,\r\n\t\t\t\t\t}),\"*\");\r\n\t\t\t\t}\r\n\t\t\t}.bind(this,message));\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\nimport Messenger from \"./Messenger.js\";\r\n\r\nexport default class ClientComponent {\r\n\tstatic ___ = {\r\n\t\topened:new Set(),\r\n\t\tinstances:new Set(),\r\n\t};\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\t\tparam.widget = param.widget || {};\r\n\r\n\t\tthis.___ = {\r\n\t\t\tid: (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16)))(),\r\n\t\t\twidget: {\r\n\t\t\t\tlimit:      param.widget.limit      || param.widgetLimit      || 1,\r\n\t\t\t\turl:        param.widget.url        || param.widgetUrl        || null,\r\n\t\t\t\tresizable:  param.widget.resizable  || param.widgetResizable  || true,\r\n\t\t\t\tscrollbars: param.widget.scrollbars || param.widgetScrollbars || true,\r\n\t\t\t\tdependent:  param.widget.dependent  || param.widgetDependent  || true,\r\n\t\t\t\twidth:      param.widget.width      || param.widgetWidth      || 600,\r\n\t\t\t\theight:     param.widget.height     || param.widgetHeight     || 400,\r\n\t\t\t\ttop:        param.widget.top        || param.widgetTop        || null,\r\n\t\t\t\tleft:       param.widget.left       || param.widgetLeft       || null,\r\n\t\t\t\twindow:     null,\r\n\t\t\t},\r\n\t\t\tdefaults:undefined, // defaults data (can be set up on widget open)\r\n\t\t\tkeepDefaults:false, // if set to true, keep defaults data accross widget open/close cycles\r\n\t\t\tcloseDetectionInterval: null,\r\n\t\t};\r\n\r\n\t\tthis.___.events = new EventDispatcher(this);\r\n\t\tthis.___.messenger = new Messenger({id:this.___.id});\r\n\t\tthis.___.messenger.on('message',this.___handleMessage.bind(this));\r\n\r\n\t\tClientComponent.___.instances.add(this);\r\n\r\n\t\t// handle native defaults data exchange\r\n\t\tthis.___on('widget.ready',this.___postDefaults.bind(this)); // automatic on widget is ready\r\n\r\n\t\t// autoclose widget on client page refresh or close\r\n\t\twindow.addEventListener(\"beforeunload\",this.close.bind(this),true);\r\n\t}\r\n\r\n\t// call a method or apply a calback on all client instances registered\r\n\tstatic invokeAll(methodOrCallback,args) {\r\n\t\tif(typeof methodOrCallback === \"function\")\r\n\t\t{\r\n\t\t\tClientComponent.___.instances.forEach(function(client) { methodOrCallback(client) });\r\n\t\t}\r\n\t\telse if(typeof methodOrCallback === \"string\")\r\n\t\t{\r\n\t\t\tClientComponent.___.instances.forEach(function(client) {\r\n\t\t\t\treturn typeof client?.[methodOrCallback] === \"function\" ? client?.[methodOrCallback](...args) : null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t___getId() { return this.___.id; }\r\n\tgetId() { return this.___getId(); }\r\n\r\n\t/* --------------------------------------------------\r\n\t * Native available events\r\n\t * --------------------------------------------------\r\n\t * widget.open\r\n\t * widget.ready\r\n\t * widget.close\r\n\t*/\r\n\t___on(eventName,callback) { this.___.events.registerEvent(eventName,callback) }\r\n\ton(eventName,callback) { this.___on(eventName,callback); }\r\n\r\n\t___off(eventName,callback) { this.___.events.unregisterEvent(eventName,callback) }\r\n\toff(eventName,callback) { this.___off(eventName,callback); }\r\n\r\n\t// all the events are handled by the messenger services\r\n\t___fire(eventName,data,dest=null) {\r\n\t\t// send event to the widget\r\n\t\tif(dest === null || dest === \"broadcast\")\r\n\t\t\tthis.___.messenger.send({eventName, data});\r\n\t\t// fire the event locally\r\n\t\tif(dest === null || dest === \"local\")\r\n\t\t\tthis.___.events.fireEvent(eventName, data);\r\n\t}\r\n\tfire(eventName,data,dest=null) { this.___fire(eventName,data,dest); }\r\n\r\n\t___open(widgetOptions=null,defaults=undefined) {\r\n\t\t// close current instance (if previously opened)\r\n\t\tthis.close();\r\n\t\t// close any extra instances  previously opened\r\n\t\tthis.___openedLimitRelease();\r\n\t\t// open new window and register the client as opened\r\n\r\n\t\twidgetOptions = widgetOptions || {};\r\n\t\twidgetOptions.url        = widgetOptions.url        || this.___.widget.url;\r\n\t\twidgetOptions.resizable  = widgetOptions.resizable  || this.___.widget.resizable;\r\n\t\twidgetOptions.scrollbars = widgetOptions.scrollbars || this.___.widget.scrollbars;\r\n\t\twidgetOptions.dependent  = widgetOptions.dependent  || this.___.widget.dependent;\r\n\t\twidgetOptions.width      = widgetOptions.width      || this.___.widget.width;\r\n\t\twidgetOptions.height     = widgetOptions.height     || this.___.widget.height;\r\n\t\twidgetOptions.top        = widgetOptions.top        || this.___.widget.top;\r\n\t\twidgetOptions.left       = widgetOptions.left       || this.___.widget.left;\r\n\r\n\t\t// position set at screen center if top or left no set\r\n\t\twidgetOptions.top = widgetOptions.top || (screen.height - widgetOptions.height) / 2;\r\n\t\twidgetOptions.left = widgetOptions.left || (screen.width - widgetOptions.width) / 2;\r\n\r\n\t\tvar windowSettings = [];\r\n\t\twindowSettings.push(`resizable=${widgetOptions.resizable ? 'yes':'no'}`);\r\n\t\twindowSettings.push(`scrollbars=${widgetOptions.scrollbars ? 'yes':'no'}`);\r\n\t\twindowSettings.push(`dependent=${widgetOptions.dependent ? 'yes':'no'}`);\r\n\t\tif(widgetOptions.width)  windowSettings.push(`width=${widgetOptions.width}`);\r\n\t\tif(widgetOptions.height) windowSettings.push(`height=${widgetOptions.height}`);\r\n\t\tif(widgetOptions.top)    windowSettings.push(`top=${widgetOptions.top}`);\r\n\t\tif(widgetOptions.left)   windowSettings.push(`left=${widgetOptions.left}`);\r\n\r\n\t\tvar widgetUrl = widgetOptions.url;\r\n\r\n\t\tif(!widgetUrl)\r\n\t\t{\r\n\t\t\tthrow `widget url parameter missing`;\r\n\t\t\treturn ;\r\n\t\t}\r\n\r\n\t\tif(defaults!==undefined)\r\n\t\t\tthis.___.defaults = defaults;\r\n\r\n\t\tthis.___.widget.window = window.open(widgetUrl, this.___.id, windowSettings.join(','));\r\n\r\n\t\tClientComponent.___.opened.add(this);\r\n\t\t// then set messenger link, send event and start the \"close\" watcher\r\n\t\tthis.___.messenger.setRecipient(this.___.widget.window);\r\n\t\tthis.___fire('widget.open',null,\"local\");\r\n\t\tthis.___startDetectionLoop();\r\n\t}\r\n\topen(widgetOptions,defaults=null) { this.___open(widgetOptions,defaults); }\r\n\r\n\t___close() {\r\n\t\tthis.___stopDetectionLoop();\r\n\t\tthis.___.messenger.clearRecipient();\r\n\t\tClientComponent.___.opened.delete(this);\r\n\t\tif(this.___.widget.window && !this.___.widget.window.closed)\r\n\t\t{\r\n\t\t\tthis.___.widget.window.close();\r\n\t\t\tthis.___.widget.window = null;\r\n\t\t\tif(!this.___.keepDefaults)\r\n\t\t\t\tthis.___.defaults = undefined;\r\n\t\t\tthis.___fire('widget.close',null,\"local\");\r\n\t\t}\r\n\t}\r\n\tclose() { this.___close(); }\r\n\r\n\t// **********************************************************\r\n\t// private methods\r\n\t// **********************************************************\r\n\r\n\t// close older client->widget to set a new free slot\r\n\t___openedLimitRelease() {\r\n\t\tvar deleteCount = ClientComponent.___.opened.size - this.___.widget.limit + 1;\r\n\t\tvar list = Array.from(ClientComponent.___.opened).reverse();\r\n\t\tfor (let c of list) {\r\n\t\t\tif(deleteCount>0)\r\n\t\t\t{\r\n\t\t\t\tdeleteCount--;\r\n\t\t\t\tc.close();\r\n\t\t\t\tClientComponent.___.opened.delete(c)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// generic message handling and event dispatch\r\n\t___handleMessage(message) {\r\n\t\tif(message.eventName)\r\n\t\t{\r\n\t\t\t// received event => only local dispatch\r\n\t\t\tthis.___fire(message.eventName, message.data, \"local\");\r\n\t\t}\r\n\t}\r\n\r\n\t___postDefaults() {\r\n\t\tif(this.___.defaults)\r\n\t\t{\r\n\t\t\tthis.___.messenger.send({\r\n\t\t\t\teventName:'client.postDefaults',\r\n\t\t\t\tdata:this.___.defaults\r\n\t\t\t});\r\n\t\t\t// we dont unset the data so each time we reload the data still remain for a new initialization\r\n\t\t}\r\n\t}\r\n\tpostDefaults() {\r\n\t\tthis.___postDefaults()\r\n\t}\r\n\r\n\t___setDefaults(defaults) {\r\n\t\tthis.___.defaults = defaults;\r\n\t\tthis.___postDefaults(); // send the new defaults\r\n\t}\r\n\tsetDefaults(defaults) {\r\n\t\tthis.___setDefaults(defaults)\r\n\t}\r\n\t___keepDefaults(keep) {\r\n\t\tthis.___.keepDefaults = keep;\r\n\t}\r\n\tkeepDefaults(keep) {\r\n\t\tthis.___keepDefaults(keep)\r\n\t}\r\n\r\n\t// passive detection of widget popup close event\r\n\t// we do not need messenging for this\r\n\t___stopDetectionLoop() {\r\n\t\tclearInterval(this.___.closeDetectionInterval);\r\n\t\tthis.___.closeDetectionInterval = null;\r\n\t}\r\n\t___startDetectionLoop() {\r\n\t\tif(this.___.widget.window.closed)\r\n\t\t{\r\n\t\t\tthis.___close();\r\n\t\t\tthis.___fire('widget.close',null,\"local\");\r\n\t\t}\r\n\t\telse if(!this.___.closeDetectionInterval)\r\n\t\t{\r\n\t\t\tthis.___.closeDetectionInterval = setInterval(this.___startDetectionLoop.bind(this),10);\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\nimport Messenger from \"./Messenger.js\";\r\n\r\nexport default  class WidgetComponent {\r\n\tstatic ___ = { };\r\n\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.___ = {\r\n\t\t\tid: param.id || window.name, // as default behavior, JS client set the ID in the windows name\r\n\t\t\tparentWindow: param.parentWindow || window.opener,\r\n\t\t\tdefaults:undefined,\r\n\t\t\tdefaultsVersion:0,\r\n\t\t};\r\n\r\n\t\tthis.___.events = new EventDispatcher(this);\r\n\t\tthis.___.messenger = new Messenger({\r\n\t\t\tid:this.___.id,\r\n\t\t\trecipient: this.___.parentWindow\r\n\t\t});\r\n\t\tthis.___.messenger.on('message',this.___handleMessage.bind(this));\r\n\r\n\t\t// send a ready message to the opener\r\n\t\tsetTimeout(function(){ this.___fire('widget.ready',null,\"broadcast\"); }.bind(this),0);\r\n\r\n\t\tthis.___on('client.postDefaults',this.___handleDefaults.bind(this));\r\n\t}\r\n\r\n\t___getId() { return this.___.id; }\r\n\tgetId() { return this.___getId(); }\r\n\r\n\t/* --------------------------------------------------\r\n\t * Native available events\r\n\t * --------------------------------------------------\r\n\t * client.postDefaults // avoid to use this one\r\n\t * widget.defaults.init\r\n\t * widget.defaults.update\r\n\t */\r\n\r\n\t___on(eventName,callback) { this.___.events.registerEvent(eventName,callback); }\r\n\ton(eventName,callback) { this.___on(eventName,callback); }\r\n\r\n\t___off(eventName,callback) { this.___.events.unregisterEvent(eventName,callback); }\r\n\toff(eventName,callback) { this.___off(eventName,callback); }\r\n\r\n\t// all the events are handled by the messenger services\r\n\t___fire(eventName,data,dest=null) {\r\n\t\t// send event to the widget\r\n\t\tif(dest === null || dest === \"broadcast\")\r\n\t\t{\r\n\t\t\tthis.___.messenger.send({eventName, data});\r\n\t\t}\r\n\t\t// fire the event locally\r\n\t\tif(dest === null || dest === \"local\")\r\n\t\t\tthis.___.events.fireEvent(eventName, data);\r\n\t}\r\n\tfire(eventName,data,dest=null) { this.___fire(eventName,data,dest); }\r\n\r\n\t___handleMessage(message) {\r\n\t\tif(message.eventName)\r\n\t\t{\r\n\t\t\t// received event => only local dispatch\r\n\t\t\tthis.___fire(message.eventName,message.data,\"local\");\r\n\t\t}\r\n\t}\r\n\r\n\t___handleDefaults(defaults)\t{\r\n\t\tthis.___.defaults = defaults;\r\n\t\tthis.___.defaultsVersion++;\r\n\r\n\t\tif(this.___.defaultsVersion===1)\r\n\t\t\tthis.___fire('widget.defaults.init',this.___.defaults,'local')\r\n\t\telse\r\n\t\t\tthis.___fire('widget.defaults.update',this.___.defaults,'local')\r\n\t}\r\n\t___getDefaults() {\r\n\t\treturn this.___.defaults;\r\n\t}\r\n\tgetDefaults() {\r\n\t\treturn this.___getDefaults();\r\n\t}\r\n\r\n\t___isDefaultsAvailable() {\r\n\t\treturn this.___.defaultsVersion>0\r\n\t}\r\n\tisDefaultsAvailable() {\r\n\t\treturn this.___isDefaultsAvailable();\r\n\t}\r\n}","import { ClientComponent } from \"../../src/index.js\"\r\n\r\nexport class Client extends ClientComponent {\r\n\r\n\t/* --------------------------------------------------\r\n\t * Inherited methods\r\n\t * --------------------------------------------------\r\n\t * open()\r\n\t * close()\r\n\t * getId()\r\n\t * on((string)eventName,(function)callback)\r\n\t * off((string)eventName,(function)callback)\r\n\t * fire((string)eventName,(mixed)data,([null,client,widget])destination)\r\n\t * --------------------------------------------------\r\n\t * Native events name\r\n\t * --------------------------------------------------\r\n\t * widget.open\r\n\t * widget.ready\r\n\t * widget.close\r\n\t * --------------------------------------------------\r\n\t * Additionnal events from the extenbded Widget class\r\n\t * --------------------------------------------------\r\n\t * select\r\n\t*/\r\n\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\t\tparam.widgetUrl = param.widgetUrl || './widget.html?custom-url=set-in-the-custom-client-class';\r\n\t\tsuper(param);\r\n\r\n\t\tthis.on('TEST-EVENT',() => console.log('TEST-EVENT received in the client'));\r\n\t}\r\n\r\n\tdisplayMessage(message) {\r\n\t\tthis.fire('display-message',message);\r\n\t}\r\n}\r\nwindow.Client = Client;"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","EventDispatcher","eventSource","this","events","Set","eventName","callback","add","data","forEach","index","bind","Messenger","param","id","replace","a","Math","random","toString","recipients","setRecipient","recipient","window","addEventListener","__handleMessage","browserWindow","clearRecipient","addRecipient","indexOf","push","i","length","registerEvent","unregisterEvent","e","JSON","parse","format","fireEvent","message","postMessage","stringify","version","ClientComponent","widget","___","limit","widgetLimit","url","widgetUrl","resizable","widgetResizable","scrollbars","widgetScrollbars","dependent","widgetDependent","width","widgetWidth","height","widgetHeight","top","widgetTop","left","widgetLeft","defaults","undefined","keepDefaults","closeDetectionInterval","messenger","on","___handleMessage","instances","___on","___postDefaults","close","___getId","___off","dest","send","___fire","widgetOptions","___openedLimitRelease","screen","windowSettings","open","join","opened","___startDetectionLoop","___open","___stopDetectionLoop","closed","___close","deleteCount","size","Array","from","reverse","c","___setDefaults","keep","___keepDefaults","clearInterval","setInterval","methodOrCallback","args","client","WidgetComponent","name","parentWindow","opener","defaultsVersion","setTimeout","___handleDefaults","___getDefaults","___isDefaultsAvailable","Client","console","log","fire"],"sourceRoot":""}