(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};
/*!********************************************!*\
  !*** ./src/WidgetComponent.js + 3 modules ***!
  \********************************************/
e.r({});class t{constructor(e){this.eventSource=e,this.events=new Set}registerEvent(e,t){"function"==typeof t&&(this.events[e]||(this.events[e]=new Set),this.events[e].add(t))}unregisterEvent(e,t){this.events[e]&&this.events[e].delete(t)}fireEvent(e,t){this.events[e]&&this.events[e].forEach(function(s,n){s(t,{eventSource:this.eventSource,eventName:e,data:t})}.bind(this))}}class s{static ___={recipients:new Set};constructor(e){e="string"==typeof e?{channel:e}:e||{},this.id=("MSG_"+[1e16]).replace(/[018]/g,(e=>(e^16*Math.random()>>e/4).toString(16))),this.channels=new Set,this.recipients=new Set,e.channel&&this.subscribe(e.channel),window.opener&&s.___.recipients.add(window.opener),this.events=new t(this),window.addEventListener("message",this.__handleMessage.bind(this))}addRecipient(e){s.___.recipients.add(e)}subscribe(e){e&&"string"==typeof e&&(console.info(`Messenger ${this.id} connected to ${e}`),this.channels.add(e))}unsubscribe(e){this.channels.delete(e)}onMessage(e,t=null){t=(t="string"==typeof t?[t]:t)&&t.length?t:[],this.events.registerEvent("message",function(e,t,s,n){(0===t.length||t.includes(s.channel))&&e(s.message,s.channel)}.bind(this,e,t))}__handleMessage(e){let t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data||{}}catch{}"messenger"===t.format&&(this.send(t.message,t.channel,e.source,!0),this.channels.has(t.channel)&&this.events.fireEvent("message",t))}send(e,t=null,s=null,n=!1){if(t&&!this.channels.has(t)){if(!n)throw`Messenger.send not subscribed to ${t}`}else{var i=t?new Set([t]):this.channels;i.size>0&&i.forEach(function(e,t,s,n){null!==t&&t!==n||this.__sendToWindows(JSON.stringify({format:"messenger",version:1,emiter:this.id,channel:n,message:e}),s)}.bind(this,e,t,s))}}__sendToWindows(e,t){s.___.recipients.forEach(function(t,s){s&&"function"==typeof s.postMessage&&(t===s||s.closed||s.postMessage(e,"*"))}.bind(this,t))}}function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i,a,l,r=function(){function e(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=n||{},this.statics={id:n.id||window.name,defaults:void 0,defaultsVersion:0},console.log(this.statics.id),this.statics.events=new t(this),this.statics.messenger=new s({channel:this.statics.id}),this.statics.messenger.onMessage(this.___handleMessage.bind(this)),setTimeout(function(){this.___fire("widget.ready",null,"broadcast")}.bind(this),0),this.___on("client.postDefaults",this.___handleDefaults.bind(this))}var i,a,l;return i=e,a=[{key:"___getId",value:function(){return this.statics.id}},{key:"getId",value:function(){return this.___getId()}},{key:"___on",value:function(e,t){this.statics.events.registerEvent(e,t)}},{key:"on",value:function(e,t){this.___on(e,t)}},{key:"___off",value:function(e,t){this.statics.events.unregisterEvent(e,t)}},{key:"off",value:function(e,t){this.___off(e,t)}},{key:"___fire",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==s&&"broadcast"!==s||this.statics.messenger.send({eventName:e,data:t}),null!==s&&"local"!==s||this.statics.events.fireEvent(e,t)}},{key:"fire",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.___fire(e,t,s)}},{key:"___handleMessage",value:function(e){e.eventName&&this.___fire(e.eventName,e.data,"local")}},{key:"___handleDefaults",value:function(e){this.statics.defaults=e,this.statics.defaultsVersion++,1===this.statics.defaultsVersion?this.___fire("widget.defaults.init",this.statics.defaults,"local"):this.___fire("widget.defaults.update",this.statics.defaults,"local")}},{key:"___getDefaults",value:function(){return this.statics.defaults}},{key:"getDefaults",value:function(){return this.___getDefaults()}},{key:"___isDefaultsAvailable",value:function(){return this.statics.defaultsVersion>0}},{key:"isDefaultsAvailable",value:function(){return this.___isDefaultsAvailable()}}],a&&n(i.prototype,a),l&&n(i,l),Object.defineProperty(i,"prototype",{writable:!1}),e}();l={},(a="statics")in(i=r)?Object.defineProperty(i,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[a]=l,window.WidgetComponent=r})();
//# sourceMappingURL=WidgetComponent.js.map