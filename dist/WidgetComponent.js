(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};
/*!********************************************!*\
  !*** ./src/WidgetComponent.js + 3 modules ***!
  \********************************************/
e.r({});class n{constructor(e){this.eventSource=e,this.events=new Set}registerEvent(e,n){"function"==typeof n&&(this.events[e]||(this.events[e]=new Set),this.events[e].add(n))}unregisterEvent(e,n){this.events[e]&&this.events[e].delete(n)}fireEvent(e,n){this.events[e]&&this.events[e].forEach(function(t,s){t(n,{eventSource:this.eventSource,eventName:e,data:n})}.bind(this))}}window.MessengerWelcome_260b9b39071b9918=function(e=null){e?t.___.recipients.add(e):window.opener&&"function"==typeof window.opener.MessengerWelcome_260b9b39071b9918&&window.opener.MessengerWelcome_260b9b39071b9918(window)};class t{static ___={recipients:new Set};constructor(e){e="string"==typeof e?{channel:e}:e||{},this.id=("MSG_"+[1e16]).replace(/[018]/g,(e=>(e^16*Math.random()>>e/4).toString(16))),this.channels=new Set,this.recipients=new Set,e.channel&&this.subscribe(e.channel),window.opener&&t.___.recipients.add(window.opener),this.events=new n(this),window.addEventListener("message",this.__handleMessage.bind(this)),window.MessengerWelcome_260b9b39071b9918()}subscribe(e){e&&"string"==typeof e&&(console.info(`Messenger ${this.id} connected to ${e}`),this.channels.add(e))}unsubscribe(e){this.channels.delete(e)}onMessage(e,n=null){n=(n="string"==typeof n?[n]:n)&&n.length?n:[],this.events.registerEvent("message",function(e,n,t,s){(0===n.length||n.includes(t.channel))&&e(t.message,t.channel)}.bind(this,e,n))}__handleMessage(e){let n="string"==typeof e.data?JSON.parse(e.data):e.data||{};"messenger"===n.format&&(this.send(n.message,n.channel,e.source,!0),this.channels.has(n.channel)&&this.events.fireEvent("message",n))}send(e,n=null,t=null,s=!1){if(n&&!this.channels.has(n)){if(!s)throw`Messenger.send not subscribed to ${n}`}else{var i=n?new Set([n]):this.channels;if(!(i.size>0))throw"Messenger.send no destination channels available";i.forEach(function(e,n,t,s){null!==n&&n!==s||this.__sendToWindows(JSON.stringify({format:"messenger",version:1,emiter:this.id,channel:s,message:e}),t)}.bind(this,e,n,t))}}__sendToWindows(e,n){t.___.recipients.forEach(function(n,t){t&&"function"==typeof t.postMessage&&(n===t||t.closed||t.postMessage(e,"*"))}.bind(this,n))}}function s(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var i,a,_,o=function(){function e(s){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),s=s||{},this.___={id:s.id||window.name,defaults:void 0,defaultsVersion:0},console.log(this.___.id),this.___.events=new n(this),this.___.messenger=new t({channel:this.___.id}),this.___.messenger.onMessage(this.___handleMessage.bind(this)),setTimeout(function(){this.___fire("widget.ready",null,"broadcast")}.bind(this),0),this.___on("client.postDefaults",this.___handleDefaults.bind(this))}var i,a,_;return i=e,a=[{key:"___getId",value:function(){return this.___.id}},{key:"getId",value:function(){return this.___getId()}},{key:"___on",value:function(e,n){this.___.events.registerEvent(e,n)}},{key:"on",value:function(e,n){this.___on(e,n)}},{key:"___off",value:function(e,n){this.___.events.unregisterEvent(e,n)}},{key:"off",value:function(e,n){this.___off(e,n)}},{key:"___fire",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==t&&"broadcast"!==t||this.___.messenger.send({eventName:e,data:n}),null!==t&&"local"!==t||this.___.events.fireEvent(e,n)}},{key:"fire",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.___fire(e,n,t)}},{key:"___handleMessage",value:function(e){e.eventName&&this.___fire(e.eventName,e.data,"local")}},{key:"___handleDefaults",value:function(e){this.___.defaults=e,this.___.defaultsVersion++,1===this.___.defaultsVersion?this.___fire("widget.defaults.init",this.___.defaults,"local"):this.___fire("widget.defaults.update",this.___.defaults,"local")}},{key:"___getDefaults",value:function(){return this.___.defaults}},{key:"getDefaults",value:function(){return this.___getDefaults()}},{key:"___isDefaultsAvailable",value:function(){return this.___.defaultsVersion>0}},{key:"isDefaultsAvailable",value:function(){return this.___isDefaultsAvailable()}}],a&&s(i.prototype,a),_&&s(i,_),Object.defineProperty(i,"prototype",{writable:!1}),e}();_={},(a="___")in(i=o)?Object.defineProperty(i,a,{value:_,enumerable:!0,configurable:!0,writable:!0}):i[a]=_,window.WidgetComponent=o})();
//# sourceMappingURL=WidgetComponent.js.map