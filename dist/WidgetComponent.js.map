{"version":3,"file":"WidgetComponent.js","mappings":"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","sources":["webpack://js-client-widget/webpack/bootstrap","webpack://js-client-widget/webpack/runtime/make namespace object","webpack://js-client-widget/./src/components/EventDispatcher.js","webpack://js-client-widget/./src/components/Messenger.js","webpack://js-client-widget/./src/components/WidgetComponent.js","webpack://js-client-widget/./src/WidgetComponent.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default class EventDispatcher {\r\n\tconstructor(eventSource) {\r\n\t\tthis.eventSource = eventSource;\r\n\t\tthis.events = new Set();\r\n\t}\r\n\r\n\t// registration methods\r\n\tregisterEvent(eventName, callback) {\r\n\t\tif(typeof callback === \"function\")\r\n\t\t{\r\n\t\t\tif(!this.events[eventName])\r\n\t\t\t\tthis.events[eventName] = new Set();\r\n\r\n\t\t\tthis.events[eventName].add(callback)\r\n\t\t}\r\n\t}\r\n\tunregisterEvent(eventName, callback) {\r\n\t\tif(this.events[eventName])\r\n\t\t\tthis.events[eventName].delete(callback)\r\n\t}\r\n\r\n\t// trigger event\r\n\tfireEvent(eventName, data) {\r\n\t\tif(this.events[eventName])\r\n\t\t{\r\n\t\t\tthis.events[eventName].forEach(function(callback, index) {\r\n\t\t\t\tcallback(data,{\r\n\t\t\t\t\teventSource:this.eventSource,\r\n\t\t\t\t\teventName:eventName,\r\n\t\t\t\t\tdata:data\r\n\t\t\t\t});\r\n\t\t\t}.bind(this))\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\n\r\nexport default class Messenger {\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.id = param.id || (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16)))();\r\n\r\n\t\tthis.recipients = [];\r\n\t\tthis.setRecipient(param.recipient);\r\n\r\n\t\tthis.events = new EventDispatcher(this);\r\n\t\twindow.addEventListener('message', this.__handleMessage.bind(this))\r\n\t}\r\n\r\n\tclearRecipient() {\r\n\t\tthis.recipients = [];\r\n\t}\r\n\tsetRecipient(browserWindow) {\r\n\t\tthis.clearRecipient();\r\n\t\tthis.addRecipient(browserWindow);\r\n\t}\r\n\taddRecipient(browserWindow) {\r\n\t\tif(browserWindow)\r\n\t\t{\r\n\t\t\tif(this.recipients.indexOf(browserWindow)<0)\r\n\t\t\t\tthis.recipients.push(browserWindow);\r\n\t\t}\r\n\t}\r\n\tdeleteRecipient(browserWindow) {\r\n\t\tif(browserWindow && this.recipients.indexOf(browserWindow)>=0)\r\n\t\t{\r\n\t\t\tfor(let i=0; i<this.recipients.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(this.recipients[i] === browserWindow)\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete this.recipients[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\ton(eventName,callback) { this.events.registerEvent(eventName,callback) }\r\n\toff(eventName,callback) { this.events.unregisterEvent(eventName,callback) }\r\n\r\n\t__handleMessage(e) {\r\n\t\tlet data = typeof e.data === \"string\" ? JSON.parse(e.data) : (e.data || {});\r\n\t\tif(data.format === 'messenger' && data.id === this.id)\r\n\t\t\tthis.events.fireEvent('message',data.message);\r\n\t}\r\n\r\n\tsend(message) {\r\n\t\tif(this.recipients.length > 0)\r\n\t\t{\r\n\t\t\tthis.recipients.forEach(function(message, recipient) {\r\n\t\t\t\tif(typeof recipient.postMessage === \"function\")\r\n\t\t\t\t{\r\n\t\t\t\t\trecipient.postMessage(JSON.stringify({\r\n\t\t\t\t\t\tformat:'messenger',\r\n\t\t\t\t\t\tversion:1,\r\n\t\t\t\t\t\tid:this.id,\r\n\t\t\t\t\t\tmessage:message,\r\n\t\t\t\t\t}),\"*\");\r\n\t\t\t\t}\r\n\t\t\t}.bind(this,message));\r\n\t\t}\r\n\t}\r\n}","import EventDispatcher from \"./EventDispatcher.js\";\r\nimport Messenger from \"./Messenger.js\";\r\n\r\nexport default  class WidgetComponent {\r\n\tstatic ___ = { };\r\n\r\n\tconstructor(param) {\r\n\t\tparam = param || {};\r\n\r\n\t\tthis.___ = {\r\n\t\t\tid: param.id || window.name, // as default behavior, JS client set the ID in the windows name\r\n\t\t\tparentWindow: param.parentWindow || window.opener,\r\n\t\t\tdefaults:undefined,\r\n\t\t\tdefaultsVersion:0,\r\n\t\t};\r\n\r\n\t\tthis.___.events = new EventDispatcher(this);\r\n\t\tthis.___.messenger = new Messenger({\r\n\t\t\tid:this.___.id,\r\n\t\t\trecipient: this.___.parentWindow\r\n\t\t});\r\n\t\tthis.___.messenger.on('message',this.___handleMessage.bind(this));\r\n\r\n\t\t// send a ready message to the opener\r\n\t\tsetTimeout(function(){ this.___fire('widget.ready',null,\"broadcast\"); }.bind(this),0);\r\n\r\n\t\tthis.___on('client.postDefaults',this.___handleDefaults.bind(this));\r\n\t}\r\n\r\n\t___getId() { return this.___.id; }\r\n\tgetId() { return this.___getId(); }\r\n\r\n\t/* --------------------------------------------------\r\n\t * Native available events\r\n\t * --------------------------------------------------\r\n\t * client.postDefaults // avoid to use this one\r\n\t * widget.defaults.init\r\n\t * widget.defaults.update\r\n\t */\r\n\r\n\t___on(eventName,callback) { this.___.events.registerEvent(eventName,callback); }\r\n\ton(eventName,callback) { this.___on(eventName,callback); }\r\n\r\n\t___off(eventName,callback) { this.___.events.unregisterEvent(eventName,callback); }\r\n\toff(eventName,callback) { this.___off(eventName,callback); }\r\n\r\n\t// all the events are handled by the messenger services\r\n\t___fire(eventName,data,dest=null) {\r\n\t\t// send event to the widget\r\n\t\tif(dest === null || dest === \"broadcast\")\r\n\t\t{\r\n\t\t\tthis.___.messenger.send({eventName, data});\r\n\t\t}\r\n\t\t// fire the event locally\r\n\t\tif(dest === null || dest === \"local\")\r\n\t\t\tthis.___.events.fireEvent(eventName, data);\r\n\t}\r\n\tfire(eventName,data,dest=null) { this.___fire(eventName,data,dest); }\r\n\r\n\t___handleMessage(message) {\r\n\t\tif(message.eventName)\r\n\t\t{\r\n\t\t\t// received event => only local dispatch\r\n\t\t\tthis.___fire(message.eventName,message.data,\"local\");\r\n\t\t}\r\n\t}\r\n\r\n\t___handleDefaults(defaults)\t{\r\n\t\tthis.___.defaults = defaults;\r\n\t\tthis.___.defaultsVersion++;\r\n\r\n\t\tif(this.___.defaultsVersion===1)\r\n\t\t\tthis.___fire('widget.defaults.init',this.___.defaults,'local')\r\n\t\telse\r\n\t\t\tthis.___fire('widget.defaults.update',this.___.defaults,'local')\r\n\t}\r\n\t___getDefaults() {\r\n\t\treturn this.___.defaults;\r\n\t}\r\n\tgetDefaults() {\r\n\t\treturn this.___getDefaults();\r\n\t}\r\n\r\n\t___isDefaultsAvailable() {\r\n\t\treturn this.___.defaultsVersion>0\r\n\t}\r\n\tisDefaultsAvailable() {\r\n\t\treturn this.___isDefaultsAvailable();\r\n\t}\r\n}","import WidgetComponent from \"./components/WidgetComponent.js\"\r\nwindow.WidgetComponent = WidgetComponent;"],"names":["__webpack_require__","exports","Symbol","toStringTag","Object","defineProperty","value","EventDispatcher","eventSource","this","events","Set","eventName","callback","add","data","forEach","index","bind","Messenger","param","id","replace","a","Math","random","toString","recipients","setRecipient","recipient","window","addEventListener","__handleMessage","browserWindow","clearRecipient","addRecipient","indexOf","push","i","length","registerEvent","unregisterEvent","e","JSON","parse","format","fireEvent","message","postMessage","stringify","version","WidgetComponent","___","name","parentWindow","opener","defaults","undefined","defaultsVersion","messenger","on","___handleMessage","setTimeout","___fire","___on","___handleDefaults","___getId","___off","dest","send","___getDefaults","___isDefaultsAvailable"],"sourceRoot":""}