(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};
/*!********************************************!*\
  !*** ./src/ClientComponent.js + 3 modules ***!
  \********************************************/
e.r({});class t{constructor(e){this.eventSource=e,this.events=new Set}registerEvent(e,t){"function"==typeof t&&(this.events[e]||(this.events[e]=new Set),this.events[e].add(t))}unregisterEvent(e,t){this.events[e]&&this.events[e].delete(t)}fireEvent(e,t){this.events[e]&&this.events[e].forEach(function(i,s){i(t,{eventSource:this.eventSource,eventName:e,data:t})}.bind(this))}}class i{static ___={recipients:new Set};constructor(e){e="string"==typeof e?{channel:e}:e||{},this.id=("MSG_"+[1e16]).replace(/[018]/g,(e=>(e^16*Math.random()>>e/4).toString(16))),this.channels=new Set,this.recipients=new Set,e.channel&&this.subscribe(e.channel),window.opener&&i.___.recipients.add(window.opener),this.events=new t(this),window.addEventListener("message",this.__handleMessage.bind(this))}addRecipient(e){i.___.recipients.add(e)}subscribe(e){e&&"string"==typeof e&&(console.info(`Messenger ${this.id} connected to ${e}`),this.channels.add(e))}unsubscribe(e){this.channels.delete(e)}onMessage(e,t=null){t=(t="string"==typeof t?[t]:t)&&t.length?t:[],this.events.registerEvent("message",function(e,t,i,s){(0===t.length||t.includes(i.channel))&&e(i.message,i.channel)}.bind(this,e,t))}__handleMessage(e){let t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data||{}}catch{}"messenger"===t.format&&(this.send(t.message,t.channel,e.source,!0),this.channels.has(t.channel)&&this.events.fireEvent("message",t))}send(e,t=null,i=null,s=!1){if(t&&!this.channels.has(t)){if(!s)throw`Messenger.send not subscribed to ${t}`}else{var n=t?new Set([t]):this.channels;n.size>0&&n.forEach(function(e,t,i,s){null!==t&&t!==s||this.__sendToWindows(JSON.stringify({format:"messenger",version:1,emiter:this.id,channel:s,message:e}),i)}.bind(this,e,t,i))}}__sendToWindows(e,t){i.___.recipients.forEach(function(t,i){i&&"function"==typeof i.postMessage&&(t===i||i.closed||i.postMessage(e,"*"))}.bind(this,t))}}function s(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var o,l,r,c=function(){function e(s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(s=s||{}).widget=s.widget||{},this.statics={id:([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^16*Math.random()>>e/4).toString(16)})),widget:{url:s.widget.url||s.widgetUrl||null,resizable:s.widget.resizable||s.widgetResizable||!0,scrollbars:s.widget.scrollbars||s.widgetScrollbars||!0,dependent:s.widget.dependent||s.widgetDependent||!0,width:s.widget.width||s.widgetWidth||600,height:s.widget.height||s.widgetHeight||400,top:s.widget.top||s.widgetTop||null,left:s.widget.left||s.widgetLeft||null,window:null},defaults:void 0,keepDefaults:!1,closeDetectionInterval:null},this.statics.events=new t(this),this.statics.messenger=new i({channel:this.statics.id}),this.statics.messenger.onMessage(this.___handleMessage.bind(this)),e.statics.instances.add(this),this.___on("widget.ready",this.___postDefaults.bind(this)),window.addEventListener("beforeunload",this.close.bind(this),!0)}var n,o,l;return n=e,o=[{key:"___getId",value:function(){return this.statics.id}},{key:"getId",value:function(){return this.___getId()}},{key:"___on",value:function(e,t){this.statics.events.registerEvent(e,t)}},{key:"on",value:function(e,t){this.___on(e,t)}},{key:"___off",value:function(e,t){this.statics.events.unregisterEvent(e,t)}},{key:"off",value:function(e,t){this.___off(e,t)}},{key:"___fire",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==i&&"broadcast"!==i||this.statics.messenger.send({eventName:e,data:t}),null!==i&&"local"!==i||this.statics.events.fireEvent(e,t)}},{key:"fire",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.___fire(e,t,i)}},{key:"___open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.close(),e.openLimitApply(!0),(t=t||{}).url=t.url||this.statics.widget.url,t.resizable=t.resizable||this.statics.widget.resizable,t.scrollbars=t.scrollbars||this.statics.widget.scrollbars,t.dependent=t.dependent||this.statics.widget.dependent,t.width=t.width||this.statics.widget.width,t.height=t.height||this.statics.widget.height,t.top=t.top||this.statics.widget.top,t.left=t.left||this.statics.widget.left,t.top=t.top||(screen.height-t.height)/2,t.left=t.left||(screen.width-t.width)/2;var s=[];s.push("resizable=".concat(t.resizable?"yes":"no")),s.push("scrollbars=".concat(t.scrollbars?"yes":"no")),s.push("dependent=".concat(t.dependent?"yes":"no")),t.width&&s.push("width=".concat(t.width)),t.height&&s.push("height=".concat(t.height)),t.top&&s.push("top=".concat(t.top)),t.left&&s.push("left=".concat(t.left));var n=t.url;if(!n)throw"widget url parameter missing";void 0!==i&&(this.statics.defaults=i),this.statics.widget.window=window.open(n,this.statics.id,s.join(",")),this.statics.messenger.addRecipient(this.statics.widget.window),e.statics.opened.add(this),this.___fire("widget.open",null,"local"),this.___startDetectionLoop()}},{key:"open",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.___open(e,t)}},{key:"___close",value:function(){this.___stopDetectionLoop(),e.statics.opened.delete(this),this.statics.widget.window&&!this.statics.widget.window.closed&&(this.statics.widget.window.close(),this.statics.widget.window=null,this.statics.keepDefaults||(this.statics.defaults=void 0),this.___fire("widget.close",null,"local"))}},{key:"close",value:function(){this.___close()}},{key:"___handleMessage",value:function(e){e.eventName&&this.___fire(e.eventName,e.data,"local")}},{key:"___postDefaults",value:function(){this.statics.defaults&&this.statics.messenger.send({eventName:"client.postDefaults",data:this.statics.defaults})}},{key:"postDefaults",value:function(){this.___postDefaults()}},{key:"___setDefaults",value:function(e){this.statics.defaults=e,this.___postDefaults()}},{key:"setDefaults",value:function(e){this.___setDefaults(e)}},{key:"___keepDefaults",value:function(e){this.statics.keepDefaults=e}},{key:"keepDefaults",value:function(e){this.___keepDefaults(e)}},{key:"___stopDetectionLoop",value:function(){clearInterval(this.statics.closeDetectionInterval),this.statics.closeDetectionInterval=null}},{key:"___startDetectionLoop",value:function(){this.statics.widget.window.closed?(this.___close(),this.___fire("widget.close",null,"local")):this.statics.closeDetectionInterval||(this.statics.closeDetectionInterval=setInterval(this.___startDetectionLoop.bind(this),10))}}],l=[{key:"setOpenLimit",value:function(t){e.statics.openLimit=t,e.openLimitApply()}},{key:"openLimitApply",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e.statics.openLimit>0){var i=e.statics.openLimit,s=e.statics.opened.size+(t?1:0);if(s>i){var n=Array.from(e.statics.opened)[0];n&&(n.close(),e.openLimitApply(t))}}}},{key:"invokeAll",value:function(t,i){"function"==typeof t?e.statics.instances.forEach((function(e){t(e)})):"string"==typeof t&&e.statics.instances.forEach((function(e){return"function"==typeof(null==e?void 0:e[t])?null==e?void 0:e[t].apply(e,s(i)):null}))}}],o&&a(n.prototype,o),l&&a(n,l),Object.defineProperty(n,"prototype",{writable:!1}),e}();o=c,l="statics",r={opened:new Set,openLimit:null,instances:new Set},l in o?Object.defineProperty(o,l,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[l]=r,window.ClientComponent=c})();
//# sourceMappingURL=ClientComponent.js.map